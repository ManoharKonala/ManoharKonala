name: featured-projects-curator

on:
  schedule:
    - cron: '0 2 * * *' # every day at 02:00 UTC
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Curate featured projects
        env:
          OWNER: 'ManoharKonala'
          GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
        run: |
          python - << 'PY'
import json, os
from github import Github
gh = Github(os.environ.get('GITHUB_TOKEN'))
user = gh.get_user(os.environ.get('OWNER'))
repos = list(user.get_repos())
repos.sort(key=lambda r: (r.stargazers_count, r.forks_count), reverse=True)
featured = []
for r in repos[:6]:
    featured.append({
        'name': r.name,
        'full_name': r.full_name,
        'stargazers_count': r.stargazers_count,
        'forks_count': r.forks_count,
        'description': r.description or ''
    })
os.makedirs('data', exist_ok=True)
with open('data/projects.json', 'w') as f:
    json.dump({'featured': featured}, f, indent=2)
print('Wrote data/projects.json')
PY
      - name: Commit
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email '41898282+github-actions[bot]@users.noreply.github.com'
          git add data/projects.json
          git commit -m "chore: update featured projects" || echo 'No changes to commit'
          git push

